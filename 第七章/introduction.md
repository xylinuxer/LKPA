# 第七章 内核中的同步

如果我们把内核看作不断对各种请求进行响应的服务器，那么，正在CPU上执行的进程、发出中断请求的外部设备等就相当于客户。正如服务器要随时响应客户的请求一样，内核也会随时响应进程、中断等的请求。我们之所以这样比喻是为了强调内核中的各个任务 <sup>[1]</sup> 并不是严格按着顺序依次执行的，而是相互交错执行的。

对所有内核任务而言，内核中的很多数据 <sup>[2]</sup> 都是共享资源，这就像高速公路供很多车辆行驶一样。对这些共享资源的访问必须遵循一定的访问规则，否则就可能造成对共享资源的破坏，就如同不遵守交通规则会造成撞车一样。

[1] 这里所定义的内核任务是指内核态下可以独立执行的内核例程（一个或多个内核函数），每个内核任务运行时都拥有一个独立的程序计数器、栈和一组寄存器。一般来说，内核任务包括内核线程、系统调用、中断服务程序、异常处理程序、下半部等几类。

[2] 这里的“数据”是广义的概念，包括变量,队列,堆栈等数据结构。